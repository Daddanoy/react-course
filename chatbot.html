<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot</title>
    <style>
      .send-button{
        background-color: rgb(25,135,84);
        color: white;
        padding: 12px 20px;
        margin-left: 10px;
        border: none;
        border-radius: 10px;
        font-size: 15px;
        cursor: pointer;

      }

      .chat-input{
        padding: 12px 15px;
        border-radius: 10px;
        border-width: 1px;
        font-size: 15px;

        flex-grow: 1; 
      
        

      }

      .chat-input-container{
        display: flex;

      }

      .app-container{
        max-width:600px;
        margin-left: auto;
        margin-right: auto;
      }
    </style>
  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    
    <script type="text/babel">

      function ChatInput({chatMessages, setChatMessages}) {
        const [inputText, setInputText] = React.useState('');
        const [isLoading, setIsLoading] = React.useState(false)

        function saveInputText(event) {
          setInputText(event.target.value);
        }

       

        async function sendMessage() {
          if(isLoading || inputText === ''){
            return;
          }

          setIsLoading(true);

          setInputText('')
          const newChatMessages = [
            ...chatMessages,
            {
              message: inputText,
              sender: 'user',
              id: crypto.randomUUID(),
            },
          ]
          //The above is the same principel as chatmessage, setchatmessage
          
            //setChatMessages(newChatMessages)

            setChatMessages([
              ...newChatMessages,
              {
                message: 'Loading...',
                sender:'robot',
                id:crypto.randomUUID()
              }
            ])

            


            //setTimeout(()=>{
              const response = await Chatbot.getResponseAsync(inputText);
           setChatMessages([
            ...newChatMessages,
            {
              message: response,
              sender: 'robot',
              id: crypto.randomUUID(),
            },
          ]);

            //},1000)
           
            setIsLoading(false)
     

          
        }

        function onEnter(event){
          if(event.key === 'Enter'){
            sendMessage()
          } else if(event.key === 'Escape'){
            setInputText('')
          }

        }

        
        


        return (
          <div className="chat-input-container"> 
            <input 
              placeholder="Send a message to the chatbot" 
              size="30" 
              onChange={saveInputText}
              value={inputText}
              onKeyDown={onEnter}
              className="chat-input"
              
              
            />
            <button
             onClick={sendMessage}
             className="send-button"//use class name to set the class in react
             >Send</button>
          </div>
        );
      }




      function ChatMessage({ message, sender }) {
        return (
          <div>
            {sender === 'robot' && (
              <img src="reeactrobot.png" width="50" />
            )} 
            {message}
            {sender === 'user' && (
              <img src="reactuser.png" width="50" />
            )}
          </div>
        );
      }

      //After we map through chatmessages array, we use ChatMessage to construct a message to display on the DOM. It takes the message, sender props to display which message needs to be placed where, the user, and the image used based on conditionals.

      function ChatMessages({chatMessages}) {
        return (
          <>
            {chatMessages.map((chatMessage) => {
              return (
                <ChatMessage 
                  message={chatMessage.message}
                  sender={chatMessage.sender}
                  key={chatMessage.id}
                />
              );
            })}
          </>
        );
      }
      //For every chat message we map through , we allocate/return  it to a chatmessage component with the mapped details attached

      function App() {

        const [chatMessages, setChatMessages] = React.useState([
          {
            message: 'hello chatbot',
            sender: 'user',
            id: 'id1',
          },
          {
            message: 'Hello! How can I help you',
            sender: 'robot',
            id: 'id2',
          },
          {
            message: 'Can you get me todays date',
            sender: 'user',
            id: 'id3',
          },
          {
            message: 'Today is September 27',
            sender: 'robot',
            id: 'id4',
          },
        ]);
        return (
          <div className="app-container">
            <ChatInput
            chatMessages = {chatMessages} 
            setChatMessages = {setChatMessages}/>
            <ChatMessages
            chatMessages ={chatMessages}
            />
          </div>
        );
      }

      //We allocate an array of messages to the chatMessages state array. Below we render the input , and messages saved to chat messages. 

      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App />);

    </script>
  </body>
</html>